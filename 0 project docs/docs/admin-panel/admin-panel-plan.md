عالی—در ادامه یک «تحلیل عمیق + مشخصات کاربردی» برای پنل ادمین ViWorkS می‌بینی که هم نیازهای امنیتی/عملیاتی را پوشش می‌دهد و هم مسیر ساخت MVP → فازهای بعد را روشن می‌کند. این متن را می‌توانی مستقیماً به‌عنوان admin-panel-spec.md به تیم بدهی.

⸻

پنل ادمین ViWorkS — تحلیل نیازمندی‌ها و مشخصات محصول

0) هدف پنل
	•	کنترل دسترسی راه‌ دور در سطح سازمان با تمرکز مطلق بر امنیت، ایزوله‌سازی کاربران، مشاهده‌پذیری (Observability) و قابلیت ممیزی.
	•	کاهش سطح حمله از طریق سیاست‌های دقیق، چرخه عمر امن اعتبارها/کلیدها، و واکنش سریع به رخدادها.
	•	یکپارچگی سازمانی با SIEM/مانیتورینگ، و انطباق با سیاست‌ها/استانداردهای سخت‌گیرانه.

اصل راهنما: هر قابلیتی باید Fail-Closed، ممیزی‌پذیر و کم‌سطح‌حمله باشد.

⸻

1) نقش‌ها و دسترسی‌ها (RBAC)

نقش	دسترسی‌ها (نمونه)
Owner / Super Admin	همه چیز + مدیریت لایسنس/ابر/On-Prem، تغییر تنظیمات امنیتی سطح‌بالا
Org Admin	مدیریت کاربران VPN/عادی/مدیر، سیاست‌ها، گره‌ها، استقرارها، تنظیمات غیرحساس
Security Admin	سیاست‌های دسترسی، دوره‌های رمز، Geo/Time/Device، وقفه و قرنطینه
Security Analyst (Read/Action)	مشاهده‌ی نشست‌ها/رویدادها، خاتمه‌ی نشست، ابطال کلید/توکن
Helpdesk (Limited)	ریست رمز کاربر VPN/عادی، مشاهدهٔ وضعیت اتصال، بدون دسترسی به سیاست
Auditor (Read-Only)	دسترسی فقط‌خواندنی به گزارش‌ها، رخدادها، و ممیزی
API Service (Machine)	توکن‌های محدود برای اتوماسیون/یکپارچگی، اسکوپ‌دار و مدت‌دار

نکته: همهٔ عملیات‌ حساس نیازمند MFA + ثبت ممیزی هستند (Who/What/When/Where).

⸻

2) دامنه داده‌ها (Entities)
	•	User (Panel): کاربر عادی/مدیر پنل با MFA، وضعیت قفل/فعال، گروه‌ها.
	•	VPN User: هویت برای سرویس دسترسی، کلید/سرتیفیکیت/سیاست اختصاصی.
	•	Session: نشست‌های فعال/تاریخی، زمان شروع/پایان، گره، IP، وضعیت، علت خاتمه.
	•	Policy: سیاست‌های دسترسی (زمان/منطقه/Geo/IP/Device/گروه/تعداد نشست همزمان/TTL).
	•	Key/Token: چرخه عمر، آخرین استفاده، قابلیت ابطال فوری.
	•	SPA/Signal Window: پنجره‌های دسترسی پنهان، موفق/ناموفق، مدت و منبع.
	•	Node/Gateway: گره‌های اتصال، ظرفیت، سلامت، نسخه.
	•	Client Versioning: کانال انتشار کلاینت، حداقل نسخه اجباری.
	•	AuditEvent: لاگ ممیزی تغییرات/ورود/رخدادها (Append-only).
	•	Integration: SIEM، مانیتورینگ، وب‌هوک‌ها، Syslog/JSON.
	•	Configuration: پارامترهای غیروحساس (نام سازمان، برندینگ)، پارامترهای حساس در Secret Store.

⸻

3) ویژگی‌های اصلی (فراتر از لیست فعلی شما)

3.1 مدیریت هویت
	•	لیست کاربران پنل (جستجو/فیلتر، ساخت، ویرایش، قفل، حذف/یا غیرفعال‌سازی).
	•	ساخت/مدیریت کاربر VPN (ایجاد، ریست/چرخش رمز/کلید، ابطال فوری).
	•	سیاست رمز (حداقل طول، پیچیدگی، انقضا، عدم‌تکرار N رمز اخیر).
	•	MFA برای پنل (اجباری برای Admin/Analyst).
	•	SSO اختیاری (SAML/OIDC) + Provisioning (SCIM) فاز بعد.

3.2 مدیریت نشست‌ها (Sessions)
	•	داشبورد زنده: تعداد نشست‌های فعال، توزیع بین گره‌ها، Top Errors، تاخیر/سلامت.
	•	فهرست نشست‌های فعال: کاربر، گره، IP (داخلی/خارجی)، شروع، مدت، وضعیت، نسخه کلاینت.
	•	جزئیات نشست: لاگ‌های سطح‌بالا (غیرحساس)، تاریخچه‌ی سیاست‌ها/تصمیم‌ها، اقدامات.
	•	اقدامات سریع: پایان نشست، قرنطینه کاربر، ابطال توکن/کلید، الزام Re-Auth.
	•	تعیین سقف نشست همزمان (Per-user / Per-group / Global).

3.3 سیاست‌های دسترسی (Policy Engine)
	•	زمان‌بندی دسترسی: ساعات/روزهای مجاز (مثلاً 08–18).
	•	محدودیت منطقه/Timezone: enforce Asia/Tehran، یا سیاست‌های جغرافیایی/کشوری.
	•	IP Allow/Block: محدوده‌های مجاز/مسدود (CIDR).
	•	Device Binding (فاز 2): وابستگی به Device ID/Certificate/Hardware Key.
	•	Concurrent Session Limit و Idle Timeout.
	•	Approval Workflow (فاز 2): دسترسی موقتی با تأیید مدیریتی.

3.4 پنهان‌سازی سرویس و SPA
	•	تعریف پنجره‌های SPA: مدت، دفعات مجاز، محدودیت منبع.
	•	نمایش آمار SPA: موفق/ناموفق، منبع، هم‌بستگی با تلاش ورود.
	•	تنظیم کلیدهای SPA: چرخش دوره‌ای، ابطال، گزارش استفاده.

3.5 مدیریت کلاینت و نسخه‌ها
	•	کانال انتشار: Stable/Beta، حداقل نسخه اجباری.
	•	اجبار به‌روزرسانی: بلوکه‌کردن نسخه‌های قدیمی.
	•	پیکربندی از راه دور (غیروحساس): تایم‌اوت‌ها، سیاست UI (نمایش/عدم‌نمایش برخی بخش‌ها).

3.6 مدیریت گره‌ها/ظرفیت (Nodes)
	•	سلامت گره‌ها: وضعیت سرویس‌ها، ظرفیت، نسخه‌ها.
	•	تخصیص کاربر/گروه به گره/خوشه (Pin/Prefer).
	•	برنامهٔ تعمیر/به‌روزرسانی: Drain/Quarantine گره‌ها.

3.7 ادغام سازمانی (SIEM/Monitoring)
	•	SIEM Connectors: Syslog/JSON، فیلتر/فورمت، استریم امن.
	•	Webhooks: روی رویدادهای کلیدی (LoginFailed/KeyRevoked/SessionEnded…).
	•	Monitoring Exporters: متریک‌های سلامت و ظرفیت.

3.8 ممیزی و گزارش
	•	Audit Trail: هر اقدام ادمین/کاربر، با جزئیات (Actor, Action, Target, Result, IP, User-Agent, Timestamp).
	•	Immutable Logs: زنجیره هش (Hash Chain) یا نوشتن در Storage فقط-افزودنی.
	•	گزارش‌ها: استفادهٔ دوره‌ای، رخدادهای امنیتی، گزارش کمپلاینس (Export CSV/PDF).

3.9 عملیات امنیتی و واکنش
	•	وقفه/قرنطینه کاربر/گروه (Block All Access).
	•	Revoke All: ابطال همهٔ توکن‌ها/کلیدها در رخداد بحرانی.
	•	Break-Glass Account: حساب اضطراری با MFA سخت و لاگ شدید، زمان‌دار.

3.10 مدیریت رمزها/کلیدها
	•	چرخش خودکار: دوره‌ای/به‌صورت رویدادی (Compromise suspected).
	•	سیاست انقضا: TTL برای کلید/توکن/گواهی‌ها.
	•	انبار اسرار: ذخیره امن سمت سرور (Vault/Kernel Keyring/…).

موارد فهرست‌شدهٔ شما (ایجاد/حذف/تغییر پسورد کاربران VPN/عادی/مدیر + شمارش نشست‌های فعال) در این معماری پوشش داده شده و توسعه داده می‌شود.

⸻

4) امنیت پنل (اپ وب)

4.1 هویت و نشست
	•	MFA اجباری برای همهٔ ادمین‌ها؛ توصیه‌ی FIDO2.
	•	Session Cookie امن (HttpOnly, Secure, SameSite=Strict) یا Token با Rotation.
	•	قفل حساب بعد از چند تلاش ناموفق، Backoff و هشدار.

4.2 محافظت اپلیکیشن
	•	CSP سختگیرانه، بدون inline-script؛ HSTS, SRI برای منابع استاتیک.
	•	CSRF Token برای فرم‌ها و درخواست‌های حساس.
	•	RBAC/ABAC سروری، کنترل IDOR، محدودیت نرخ (Rate Limiting).
	•	ورودی امن: Validation/Encoding؛ No Mass Assignment.
	•	ثبت و پایش امنیتی: تلاش‌های ناموفق، تغییر نقش‌ها، تغییر سیاست‌ها.

4.3 سطح شبکه/استقرار
	•	IP Allow-list برای دسترسی پنل ادمین (اختیاری ولی توصیه‌شده).
	•	mTLS بین اجزای داخلی؛ TLS سخت‌گیری‌شده رو به بیرون.
	•	جداسازی شبکه: پنل، API، پایگاه‌داده در سگمنت‌های مجزا؛ Firewall Ruleهای صریح.

⸻

5) تجربه کاربری (صفحات کلیدی)
	•	Dashboard: کارت آمار (نشست‌های فعال، پنجره‌های SPA امروز، خطاها)، گراف‌های سری زمانی، وضعیت گره‌ها، اعلان‌ها.
	•	Users (Panel): لیست/ساخت/ویرایش/قفل/حذف، نقش و MFA، تاریخچهٔ ورود.
	•	VPN Users: ساخت/ابطال کلید/ریست رمز، سیاست اختصاصی، نشست‌های اخیر.
	•	Sessions: لیست زنده + فیلتر (کاربر/گره/مدت/وضعیت)، اقدام سریع (پایان/قرنطینه).
	•	Policies: تعریف/ویرایش سیاست‌ها (زمان/Geo/IP/Device/Concurrency/Idle).
	•	Nodes: سلامت، ظرفیت، نسخه، Drain/Quarantine.
	•	Integrations: SIEM/Monitoring/Webhooks، تست اتصال.
	•	Audit & Reports: جستجوی رخدادها، Export، گزارش‌های آماده.
	•	Settings: برندینگ، تنظیمات ظاهری، پیکربندی غیروحساس، مدیریت کلیدهای عمومی مشتری (برای Trust Portal).
	•	My Profile: تغییر رمز، MFA، توکن‌های API شخصی (با اسکوپ).

⸻

6) جریان‌های حیاتی (Workflows)

6.1 ساخت کاربر VPN
	1.	Admin → New VPN User
	2.	تعیین سیاست پایه (یا ارث‌بری از گروه)
	3.	صدور/اختصاص کلید/اعتبار (نمایش یک‌بار/دانلود امن)
	4.	ثبت ممیزی + ارسال اعلان به SIEM

6.2 چرخش رمز/کلید
	1.	انتخاب کاربر/گروه → Rotate
	2.	ابطال اعتبار قبلی + صدور جدید (Delay قابل‌تنظیم برای نشست جاری)
	3.	الزامی‌سازی Re-Auth در اتصال بعدی

6.3 مدیریت نشست
	1.	مشاهده نشست → جزئیات → پایان/قرنطینه
	2.	ثبت علت/کد اقدام (برای ممیزی)
	3.	SIEM/Webhook رویداد

6.4 تغییر سیاست
	1.	ویرایش → پیش‌نمایش اثر (Dry-Run) → انتشار زمان‌دار/فوری
	2.	ثبت ممیزی نسخهٔ سیاست + امکان Rollback

⸻

7) گزارش‌دهی و مانیتورینگ
	•	گزارش‌های آماده: استفادهٔ ماهانه، خطاها، ورود/خروج‌ها، تغییرات سیاست، نشست‌های طولانی.
	•	Export: CSV/PDF با واترمارک و امضای دیجیتال (فاز 2).
	•	متریک‌ها: نشست/کاربر/گره، موفقیت SPA، خطاهای OpenVPN، میانگین زمان اتصال، ظرفیت.

⸻

8) ادغام و اعلان‌ها
	•	SIEM: Syslog/CEF/JSON، انتخاب فیلدها و Redaction.
	•	Monitoring: Exporter استاندارد (Prometheus-like) یا Push.
	•	Webhooks: URL+Secret، Retry با Backoff.
	•	اعلان‌ها: ایمیل سازمانی، Slack/Teams (اختیاری)، Severity-based.

⸻

9) ممیزی/انطباق
	•	Append-Only Audit: رویدادها هش‌زنجیره‌ای شوند؛ Export با امضا.
	•	Retention Policy: نگهداری/حذف امن بر اساس دورهٔ سازمانی.
	•	Privacy: حداقل‌گرایی داده؛ PII/Log Redaction.

⸻

10) داده و اسکیمای پیشنهادی (خلاصه)
	•	users (panel_user)
	•	vpn_identities (per-user access identity)
	•	sessions (state timeline)
	•	policies + policy_versions
	•	audit_events (append-only, hash_chain_prev)
	•	nodes + node_health
	•	integrations (siem/webhook)
	•	client_versions (min_required, channels)

⸻

11) API و امنیت
	•	REST + JSON (یا GraphQL داخلی)، با توکن‌های اسکوپ‌دار، مدت‌دار.
	•	Rate Limit بر اساس کلید/IP/Route.
	•	Idempotency-Key برای عملیات حساس.
	•	Versioning: /v1.

⸻

12) برنامه ساخت (Roadmap)

MVP (پیشنهادی)
	•	RBAC پایه (Owner/OrgAdmin/SecAdmin/Helpdesk/Auditor)
	•	Users (پنل) + VPN Users (ساخت/حذف/ریست/چرخش)
	•	Sessions (فهرست/جزئیات/پایان)
	•	Policies (زمان/Timezone/IP/Concurrency/Idle)
	•	Nodes (نمایش سلامت پایه)
	•	Integrations (SIEM/Webhook پایه)
	•	Audit Trail کامل + CSV Export
	•	MFA اجباری برای Admin
	•	IP Allow-list برای پنل (اختیاری ولی توصیه می‌شود)

فاز 2
	•	Device Binding / Hardware Key
	•	Approval Workflow / Just-In-Time Access
	•	Immutable Logs با امضای دیجیتال + PDF Reports
	•	Client Remote Config و Forced Upgrade
	•	SSO/SCIM
	•	Break-Glass با سیاست‌های ویژه

⸻

13) معیارهای پذیرش (نمونه)
	•	هر تغییر نقش/سیاست/رمز در Audit ثبت و قابل جستجو باشد.
	•	امکان پایان فوری نشست کاربر و مشاهدهٔ نتیجه.
	•	ریست/چرخش رمز/کلید بدون افشای حساسات در UI/Log.
	•	لاگ‌ها PII-Redacted و قابل ارسال امن به SIEM باشند.
	•	MFA اجباری برای نقش‌های ادمینی فعال باشد.
	•	Fail-Closed: خطا در یکپارچگی یا سیگنال → دسترسی مسدود.

⸻

14) نکات اجرایی UI/UX
	•	فیلترهای سریع، جستجوی Full-Text با Debounce.
	•	جدول‌ها با ستون‌های قابل سفارشی‌سازی و Export.
	•	صفحات جزئیات با Activity Timeline و Quick Actions.
	•	Empty States با راهنمای عمل.
	•	پیغام‌های خطا/هشدار غیر‌افشاگرانه و دارای کُد ارجاع.

⸻

15) عملیات و پایداری
	•	Backup/DR از DB و لاگ‌های ممیزی (رمزشده).
	•	Health Checks و صفحهٔ وضعیت داخلی.
	•	Secrets Rotation منظم.
	•	Patch Management برای پنل/گره‌ها.

⸻

نتیجه

با این مشخصات، پنل ادمین ViWorkS نه‌تنها نیازهای پایه‌ای مدیریت کاربران و نشست‌ها را پوشش می‌دهد، بلکه ابزارهای سیاست‌گذاری دقیق، ممیزی قوی، ادغام سازمانی و واکنش سریع را نیز فراهم می‌کند—همه با محوریت کاهش سطح حمله و سادگی عملیاتی.